# 要件定義 (rd.md)

## 1. プロジェクト概要
AIエージェントやアプリケーションへの応答を「顔のジェスチャー」で行うための、バーチャルキーボード型入力支援ツール。
Rust言語と即時モードGUI (`egui`) の採用により、高レスポンスな操作性とマルチプラットフォーム展開を実現する。

## 2. ターゲット
- **PCユーザー全般**: AIチャット、SNS、動画視聴などでハンズフリー操作を求めるすべての人。
- **開発者**: AIエージェント（CLI, IDE等）と対話するエンジニア。

## 3. 主要機能
### 3.1. 顔認識・ジェスチャー判定
- カメラ映像からのリアルタイム顔認識。
- **実装技術**: ONNX Runtime (デスクトップ版: `ort`, ブラウザ拡張機能版: `tract`) で学習済みモデル (MediaPipe Face Detection等) を推論。
- 縦の振り（YES）、横の振り（NO）の判定。

### 3.2. バーチャルキーボード（Native版：デスクトップ）
- **[Phase 2]** ジェスチャー検知時に、OSレベルでキー入力を送信する。
    - **実装技術**: `enigo` クレート。
    - YES判定: 「YES」という文字列を入力 + `Enter` キー。
    - NO判定: 「NO」という文字列を入力 + `Enter` キー。
    - **誤爆防止機能 (Window Guard)**:
        - **シングルターゲット方式**: プルダウンメニューで「すべてのウィンドウ」または「特定のウィンドウ（例: VS Code）」を選択可能。
        - 選択されたウィンドウがアクティブな時のみ、入力を送信する。
    - **一時停止ホットキー (Global Pause)**:
        - グローバルショートカットキーにより、いつでもジェスチャー判定のON/OFFを切り替え可能。
    - **予告インジケータ (Pre-Input Warning)**:
        - ジェスチャー検知後、実際にキーを送信する前に視覚的な予告（インジケータ）を表示。
        - 予告期間中（約0.5秒）にユーザーがジェスチャーを中断または顔を逸らせば、入力をキャンセルする。
    - **音声入力・コマンド (Voice & デスクトップ版 Synergy) [Phase 4]**:
        - **音声テキスト入力**: マイクからの入力をテキストとしてアクティブウィンドウに送信。
        - **音声コマンド**: 「エンター (Enter)」「クリア (Clear)」などの声でキー入力を実行。
        - **多言語対応 (i18n)**: 音声認識エンジンの言語設定切り替え（日本語/英語等）。
        - **カスタムエイリアス**: ユーザーが独自のキーワード（例：「実行！」）をコマンドに割り当て可能。

### 3.3. ブラウザ拡張機能版
- **[Phase 3]** ブラウザ内でのAIチャット操作に特化した自動入力機能。
    - **サイドパネル動作**: ブラウザのサイドパネルでジェスチャー判定を行い、メイン画面のタブに介入。
    - **自動送信 (Auto-Submit)**:
        - YES判定: アクティブなタブの入力欄に「YES」を注入し、送信ボタンを自動でクリック。
        - NO判定: 入力欄に「NO」を注入し、送信ボタンを自動でクリック。
    - **音声オーバーレイ (Voice Overlay) [Phase 4]**:
        - **音声入力**: マイクに向かって話した内容をテキストとして入力欄に転記。
        - **音声コマンド**: 「送信」「クリア」「次へ」などの声による操作（多言語対応）。
    - **ターゲットAIチャットサービス**: 以下の主要サービスを初期プリセットとして対応する。
        - **ChatGPT** (`chatgpt.com`)
        - **Claude** (`claude.ai`)
        - **Gemini** (`gemini.google.com`)
        - **Perplexity** (`perplexity.ai`)

### 3.4. GUIアプリケーション (共通)
- **実装技術**: `eframe` (`egui`)。
- **デバイス切り替え**: 複数のカメラ・マイクをドロップダウンで即座に切り替え可能にする。
- **プライバシー保護プレビュー**:
    - **[Phase 2]**: ランドマークの線画化、ぼかし、モザイク処理。
    - **[Phase 5]**: AIによる高精度な背景除去・差し替え機能。
- 現在の判定状態（YES/NO/UNKNOWN）の視覚的表示（スタンプ風アニメーション等）。

### 3.5. MCPサーバー機能
- **[Phase 5] (デスクトップ版のみ)** AIエージェントからの「現在の判定状態」の問い合わせに応答する機能の追加。

## 4. 非機能要件
- **安全性**: 画像データをメモリセーフに扱い、外部送信を行わない。
- **ポータビリティ**: シングルバイナリ配布（デスクトップ版）と、ブラウザ拡張機能（WASM版）の両立を考慮した設計。
- **パフォーマンス**: バックグラウンド動作時もCPU負荷を最小限に抑える。

## 5. 将来的な拡張性
- 表情認識、アイトラッキング等の追加。
