# エラーハンドリングとログ (error_logging.md)

## 1. エラーハンドリング指針

- **`thiserror` クレートの利用**: 各モジュール固有のエラー（`CameraError`, `DetectionError`, `McpError` 等）を定義し、原因を明確にする。
- **`anyhow` クレートの利用**: `main.rs` や `interface` レイヤーなど、具体的なエラー型を区別する必要がなく、集約して報告する箇所で使用。
- **早期リターンとコンテキスト**: `.context("failed to open camera")` などを用いて、エラーが発生した状況を付与する。

## 2. ログ出力方針

- **`tracing` クレートの利用**: 構造化ログを導入し、スレッドを跨いだ処理の追跡を容易にする。
- **ログレベル**:
    - `ERROR`: 継続不可能なエラー（カメラが外れた、MCP通信切断）。
    - `WARN`: 予期せぬ挙動だが継続可能（顔がロストした、フレームドロップ）。
    - `INFO`: 主要なイベント（アプリ起動、MCPクライアント接続、判定状態の変化）。
    - `DEBUG`: 開発用（各フレームの座標データ、内部状態遷移）。
- **出力先**:
    - デバッグ時は `stdout`/`stderr`。
    - リリース時は設定によりファイル出力（`kaoiro.log`）。

## 3. プライバシーへの配慮
- ログには **個人情報（顔画像データ、氏名等）を決して含めない**。
- 記録するのは「判定結果（YES/NO）」と「システムの状態」のみに限定する。
